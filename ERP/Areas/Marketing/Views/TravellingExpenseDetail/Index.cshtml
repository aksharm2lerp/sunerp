@using Business.Entities.Marketing.TravellingExpenseDetailModel;
@using System.Security.Claims
@model TravellingExpenseDetail;
@inject SignInManager<UserMasterMetadata> SignInManager
@inject UserManager<UserMasterMetadata> UserManager
@{
    ViewData["Title"] = "TravellingExpenseDetail List..";
    Layout = "~/Views/Shared/_LayoutMaster.cshtml";
}
@{
    ClaimsPrincipal user = User;
    var userlogin = UserManager.GetUserAsync(User).Result;
    var roles = UserManager.GetRolesAsync(userlogin).Result;
    var claimRole = user.Claims;
    var claimRoleName = user.Claims.FirstOrDefault(x => x.Type == "RoleName");
}

<div class="col-sm-12 col-md-12 col-lg-12 mx-auto">
    <div class="card border-1 shadow rounded-7 p-1">
        <div class="row border-bottom">
            <div class="col-sm-12 col-md-6 col-lg-6">
                <div class="page-breadcrumb align-items-center">
                    <div class="p-2">
                        <nav aria-label="breadcrumb">
                            <ol class="breadcrumb mb-0 p-0">
                                <li class="breadcrumb-item">
                                    <a asp-area="Marketing" asp-controller="TravellingExpenseDetail" asp-action="Index"><i class="bx bx-home-alt"></i></a>
                                </li>
                                <li class="breadcrumb-item active" aria-current="page">Travelling Expense Detail List</li>
                            </ol>
                        </nav>
                    </div>
                </div>
            </div>

            <div class="col-sm-12 col-md-6 col-lg-6 text-end my-2">
                <a class="btn btn-primary px-5" onclick="fnTravellingExpenseDetail(this)"
                   href="javascript:void(0)"
                   data-id="0"
                   data-key="0"
                   data-bs-toggle="offcanvas"
                   data-bs-target="#canvas_TravellingExpenseDetail"
                   aria-controls="canvas_masterentity">
                    Add New
                </a>
            </div>

        </div>
        <div class="row">
            <div class="col-md-12">
                @* <grid model="@Model" /> *@
                <div class="table-responsive">
                    <table class="table table-bordered">
                        <thead>
                            <tr>
                                <th scope="col">Sr No.</th>
                                <th scope="col">Marketing Person</th>
                                <th scope="col">Party Name</th>
                                <th scope="col">Travelling Date</th>
                                <th scope="col">From</th>
                                <th scope="col">To</th>
                                <th scope="col">Amount</th>
                                <th scope="col">Bill Files</th>
                                @if (claimRoleName.Value.Equals("HR Super Admin") || claimRoleName.Value.Equals("SuperAdmin"))
                                {
                                    <th scope="col">Status</th>
                                }
                                else
                                {
                                    <th scope="col">Status</th>
                                }
                                @if (claimRoleName.Value.Equals("ERP User") || claimRoleName.Value.Equals("Developer") || claimRoleName.Value.Equals("Admin"))
                                {
                                    <th scope="col">Edit</th>
                                }

                            </tr>
                        </thead>
                        <tbody>
                            @{
                                int SrNo = 1;
                            }

                            @foreach (var itemsLTED in Model.listTravellingExpenseDetail)
                            {

                                <tr>
                                    @* <th>@itemsLTED.SrNo</th> *@
                                    <th>@SrNo</th>
                                    <td>@itemsLTED.MarketingPerson</td>
                                    <td>@itemsLTED.PartyName</td>
                                    <td>@itemsLTED.TravellingDate</td>
                                    <td>@itemsLTED.FromLocation</td>
                                    <td>@itemsLTED.ToLocation</td>
                                    <td> &#8377; @itemsLTED.Amount/-</td>
                                    <td>
                                        @foreach (var itemLTEBI in Model.listTravellingExpenseBillsImages)
                                        {
                                            @if (@itemLTEBI.TravellingExpenseDetailID == @itemsLTED.TravellingExpenseDetailID)
                                            {
                                                <a class='btn editaddress IndexPagebtnEidtPadding' href='/Marketing/TravellingExpenseDetail/DownloadBillFile?filename=@itemLTEBI.TravellingExpenseBillsImagesText'>
                                                    <iconify-icon icon='emojione-monotone:open-file-folder'></iconify-icon> @itemLTEBI.TravellingExpenseBillsImagesText
                                                </a> <br />
                                            }
                                        }

                                    </td>
                                    @if (claimRoleName.Value.Equals("HR Super Admin") || claimRoleName.Value.Equals("SuperAdmin"))@* || claimRoleName.Value.Equals("Developer") *@
                                    {
                                        <td>
                                            @*
                                    *   0   default Yellow color was (Waiting)  :#fef100
                                    *   6   Ligh Green color code    (Approve)  :#33ec3a
                                    *   8   Blue color code          (Hold)     :#2f7cd7
                                    *   9   Dark Green color code    (Release)  :#06a10d
                                    *   10  red color code           (Reject)   :#FF0000
                                    *@
                                            @if (itemsLTED.TravellingExpenseStatusID == 6)
                                            {
                                                <a class='pointer' onclick="fnTravellingExpenseStatus(@itemsLTED.TravellingExpenseDetailID)" href='javascript:void(0)' data-id='0' data-key='0' title='Approve' data-bs-toggle="offcanvas" data-bs-target="#canvasTravellingExpenseStatus" aria-controls="canvasTravellingExpenseStatus">
                                                    <iconify-icon icon='heroicons:rectangle-group-solid' width='50' height='31' style='color: #33ec3a'></iconify-icon>
                                                </a>
                                            }
                                            else if (itemsLTED.TravellingExpenseStatusID == 8)
                                            {
                                                <a class='pointer' onclick="fnTravellingExpenseStatus(@itemsLTED.TravellingExpenseDetailID)" href='javascript:void(0)' data-id='0' data-key='0' title='Hold' data-bs-toggle="offcanvas" data-bs-target="#canvasTravellingExpenseStatus" aria-controls="canvasTravellingExpenseStatus">
                                                    <iconify-icon icon='heroicons:rectangle-group-solid' width='50' height='31' style='color: #2f7cd7'></iconify-icon>
                                                </a>
                                            }
                                            else if (itemsLTED.TravellingExpenseStatusID == 9)
                                            {
                                                <a class='pointer' onclick="fnTravellingExpenseStatus(@itemsLTED.TravellingExpenseDetailID)" href='javascript:void(0)' data-id='0' data-key='0' title='Release' data-bs-toggle="offcanvas" data-bs-target="#canvasTravellingExpenseStatus" aria-controls="canvasTravellingExpenseStatus">
                                                    <iconify-icon icon='heroicons:rectangle-group-solid' width='50' height='31' style='color: #06a10d'></iconify-icon>
                                                </a>
                                            }
                                            else if (itemsLTED.TravellingExpenseStatusID == 10)
                                            {
                                                <a class='pointer' onclick="fnTravellingExpenseStatus(@itemsLTED.TravellingExpenseDetailID)" href='javascript:void(0)' data-id='0' data-key='0' title='Reject' data-bs-toggle="offcanvas" data-bs-target="#canvasTravellingExpenseStatus" aria-controls="canvasTravellingExpenseStatus">
                                                    <iconify-icon icon='heroicons:rectangle-group-solid' width='50' height='31' style='color: #FF0000'></iconify-icon>
                                                </a>
                                            }
                                            else
                                            {
                                                <a class='pointer' onclick="fnTravellingExpenseStatus(@itemsLTED.TravellingExpenseDetailID)" href='javascript:void(0)' data-id='0' data-key='0' title='Waiting' data-bs-toggle="offcanvas" data-bs-target="#canvasTravellingExpenseStatus" aria-controls="canvasTravellingExpenseStatus">
                                                    <iconify-icon class="" icon='heroicons:rectangle-group-solid' width='50' height='31' style='color: #fef100'></iconify-icon>
                                                </a>
                                            }
                                        </td>
                                    }
                                    else
                                    {
                                        @*
                                *   0   default Yellow color was (Waiting)  :#fef100
                                *   6   Ligh Green color code    (Approve)  :#33ec3a
                                *   8   Blue color code          (Hold)     :#2f7cd7
                                *   9   Dark Green color code    (Release)  :#06a10d
                                *   10  red color code           (Reject)   :#FF0000
                                *@
                                        @if (@itemsLTED.TravellingExpenseStatusID == 6)
                                        {
                                            <td><h6 style='color: #33ec3a'>Approve</h6></td>
                                        }
                                        else if (@itemsLTED.TravellingExpenseStatusID == 8)
                                        {
                                            <td><h6 style='color: #2f7cd7'>Hold</h6></td>
                                        }
                                        else if (@itemsLTED.TravellingExpenseStatusID == 9)
                                        {
                                            <td><h6 style='color: #06a10d'>Payment Release</h6></td>
                                        }
                                        else if (@itemsLTED.TravellingExpenseStatusID == 10)
                                        {
                                            <td><h6 style='color: #FF0000'>Reject</h6></td>
                                        }
                                        else
                                        {
                                            <td><h6 style='color: #fef100'>Waiting</h6></td>
                                        }
                                    }

                                    @if (claimRoleName.Value.Equals("ERP User") || claimRoleName.Value.Equals("Developer") || claimRoleName.Value.Equals("Admin"))
                                    {
                                        @if (@itemsLTED.TravellingExpenseStatusID > 0)
                                        {
                                            <td>
                                                <a class='btn IndexPagebtnEidtPadding' href='javascript:void(0)' disabled>
                                                    <i class='bx bx-edit'></i>
                                                </a>
                                            </td>
                                        }
                                        else
                                        {
                                            <td>
                                                <a class='btn IndexPagebtnEidtPadding' onclick='fnTravellingExpenseDetail(this)' href='javascript:void(0)' data-id='@itemsLTED.TravellingExpenseDetailID' data-bs-toggle='offcanvas' data-bs-target='#canvas_TravellingExpenseDetail' aria-controls='canvas_masterentity'>
                                                    <i class='bx bx-edit'></i>
                                                </a>
                                            </td>
                                        }
                                    }

                                </tr>
                                SrNo++;
                            }

                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="offcanvas offcanvas-end" tabindex="-1" id="canvas_TravellingExpenseDetail">
            <div class="offcanvas-header">
                <h5 class="offcanvas-title" id="canvasHeaderTravellingExpenseDetail"></h5>
                <button type="button" class="btn-close te  xt-reset" data-bs-dismiss="offcanvas" aria-l abel="Close"></button>
            </div>
            <div class="offcanvas-body pt-3 pb-5">
                <div id="dvInfoTravellingExpenseDetail">
                </div>
            </div>
        </div>
    </div>
</div>

<div class="offcanvas offcanvas-bottom" tabindex="-1" id="canvasTravellingExpenseStatus" aria-labelledby="offcanvasCompanyLabel" style="height: 60%; width: 60%; margin: 10% 20%;">
    <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="canvasTravellingExpenseStatus">Travelling Expense Status</h5>
        <button type="button" class="btn-close te  xt-reset" data-bs-dismiss="offcanvas" aria-l abel="Close"></button>
    </div>
    <div class="offcanvas-body pt-3 pb-5">
        <div id="dvInfoTravellingExpenseStatus">
        </div>
    </div>
</div>


<script type="text/javascript">
    var urladd = '@Url.Action("Get", "TravellingExpenseDetail")';

    function fnTravellingExpenseDetail(obj) {
        var _key = $(obj).data('key');
        var _id = $(obj).data('id');
        if (_id > 0) {
            document.getElementById("canvasHeaderTravellingExpenseDetail").innerHTML = "Update Travelling Expense Detail";
        }
        else {
            document.getElementById("canvasHeaderTravellingExpenseDetail").innerHTML = "Add Travelling Expense Detail";
        }

        var _parameters = { id: _id, key: _key };
        $.ajax({
            url: urladd,
            type: "GET",
            data: _parameters,
            success: function (data, textStatus, jqXHR) {
                $('#dvInfoTravellingExpenseDetail').html(data);
                $("#canvas_TravellingExpenseDetail").show();//('hide');
            }
        });
    }

    var urlTravellingExpenseStatus = '@Url.Action("TravellingExpenseStatus", "TravellingExpenseDetail")';
    function fnTravellingExpenseStatus(travellingExpenseDetailID) {
        //alert('fnTravellingExpenseStatus fn invoked-- ' + travellingExpenseDetailID);
        var _TEID = travellingExpenseDetailID; //_TEID = _TravellingExpenseID
        //var _TEID = $("#").val();
        var _parameters = { TEDID: _TEID };
        $.ajax({
            url: urlTravellingExpenseStatus,
            type: "GET",
            data: _parameters,
            success: function (data, textStatus, jqXHR) {
                //alert('TravellingExpenseStatus Form Open ');
                $("#canvasTravellingExpenseStatus").show();//('hide');
                $('#dvInfoTravellingExpenseStatus').html(data);
            },
            error: function (error) {
                //debugger;
            }
        });
    }

</script>
<script src="~/js/gridmvc.js" type="text/javascript"></script>